extends: [autotools_package]
dependencies:
  build: [mpi, zlib, szip]

sources:
- key: tar.gz:q7mmqlv2lt3wnwl42bwakt2ghhaqjhck
  url: https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.8/hdf5-1.8.21/src/hdf5-1.8.21.tar.gz

defaults:
  # /bin/h5pcc contains hard-coded path
  relocatable: false

build_stages:
- name: set-cc-compiler
  after: prologue
  before: configure
  handler: bash
  bash: |
    export CC=${MPICC}

- name: configure
  extra: ['--with-zlib=${ZLIB_DIR}',
          '--with-szlib=${SZIP_DIR}',
          '--with-pthread',
          '--enable-unsupported',
          '--enable-shared',
          '--enable-production=yes',
          '--enable-parallel=yes',
          '--enable-largefile=yes',
          '--with-default-api-version=v18']

when_build_dependency:
- set: HDF5_ROOT
  value: '${ARTIFACT}'
- prepend_path: PATH
  value: '${ARTIFACT}/bin'
