when: machine == 'CrayXC40'

extends: [setuptools_package]
dependencies:
  build: [blas, lapack, numpy]
  run: [blas, lapack, numpy]

sources:
- key: tar.gz:q7vb6ena5hwarqte3rsfkhkqd6rqokeu
  url: https://github.com/scipy/scipy/releases/download/v1.0.0/scipy-1.0.0.tar.gz

build_stages:
  - name: create-site.cfg
    after: prologue
    before: install
    handler: bash
    bash: |
      cat > site.cfg << EOF
      [DEFAULT]
      library_dirs = ${CRAY_LIBSCI_PREFIX_DIR}/lib
      libraries = sci_gnu
      [lapack]
      lapack_libs = sci_gnu
      [blas]
      blas_libs = sci_gnu
      EOF

  - name: set-LDFLAGS
    after: prologue
    before: install
    handler: bash
    bash: |
      export LDFLAGS="-shared -Wl,-rpath=${PYTHON_DIR}/lib -Wl,-rpath=${CRAY_LIBSCI_PREFIX_DIR}/lib"
      export ATLAS=None
      export LAPACK=sci_gnu
      export BLAS=sci_gnu

