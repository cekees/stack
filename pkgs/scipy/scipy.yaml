when platform != 'linux':
  extends: [distutils_package]
when platform == 'linux':
  extends: [setuptools_package, libflags]
dependencies:
  build: [blas, lapack, numpy]
  run: [blas, lapack, numpy]

sources:
- key: tar.gz:kgreeteo3ahgbpnzvclia3t23lzeuwbf
  url: https://files.pythonhosted.org/packages/ea/c8/c296904f2c852c5c129962e6ca4ba467116b08cd5b54b7180b2e77fe06b2/scipy-1.2.0.tar.gz
#- key: tar.gz:q7vb6ena5hwarqte3rsfkhkqd6rqokeu
#  url: https://github.com/scipy/scipy/releases/download/v1.0.0/scipy-1.0.0.tar.gz

build_stages:
  - when: platform == 'linux'
    name: set-lapack-paths
    after: libflags
    before: install
    handler: bash
    bash: |
      export LDFLAGS="$LDFLAGS -shared $LAPACK_LDFLAGS $BLAS_LDFLAGS"
      export ATLAS=None
      export OPENBLAS=$OPENBLAS_DIR
      export LAPACK=$LAPACK_LDFLAGS
      export BLAS=$BLAS_LDFLAGS
